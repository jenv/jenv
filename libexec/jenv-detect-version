#!/usr/bin/env bash
# Summary: Add JDK into jenv. A alias name will be generated by parsing "java -version"
# Usage: jenv add /path/to/java_home
set -e
[ -n "$JENV_DEBUG" ] && set -x

if [ ! -f "$1/bin/java" ]; then
  JAVA_VERSION="unknown"
  OS_ARCH="unknown"
  JAVA_PROVIDER="unknown"
  return
fi

JAVA_VERSION_OUTPUT=`"$1"/bin/java -version 2>&1`
JAVA_VERSION=`"$1"/bin/java -version 2>&1 | grep 'version' | head -n 1 | cut -d\" -f 2 `
JAVA_VERSION=${JAVA_VERSION/_/.}
OS_ARCH=`"$1"/bin/java -XshowSettings:all -version 2>&1 | grep os.arch | cut -d= -f2 | xargs`
if [ -z "$OS_ARCH" ]; then
  OS_ARCH="unknown"
fi

case "${JAVA_VERSION_OUTPUT}" in
    *HotSpot*)                          JAVA_PROVIDER="oracle" ;;
    *Zulu*)                             JAVA_PROVIDER="zulu" ;;
    *Zing*)                             JAVA_PROVIDER="zulu_prime" ;;
    *GraalVM*)                          JAVA_PROVIDER="graalvm" ;;
    *Corretto*)                         JAVA_PROVIDER="corretto" ;;
    *sapmachine*)                       JAVA_PROVIDER="sap" ;;
    *SapMachine*)                       JAVA_PROVIDER="sap" ;;
    *SAP*)                              JAVA_PROVIDER="sap" ;;
    *Temurin*)                          JAVA_PROVIDER="temurin" ;;
    *JBR*)                              JAVA_PROVIDER="jetbrains" ;;
    *Kona*)                             JAVA_PROVIDER="kona" ;;
    *OpenLogic*)                        JAVA_PROVIDER="openlogic" ;;
    *Semeru\ Runtime\ Open*)            JAVA_PROVIDER="semeru" ;;
    *Semeru\ Runtime\ Certified*)       JAVA_PROVIDER="semeru_certified" ;;
    *Dragonwell*)                       JAVA_PROVIDER="dragonwell" ;;
    *J9*)                               JAVA_PROVIDER="ibm" ;;
    *OpenJDK*)                          JAVA_PROVIDER="openjdk" ;;
    *)                                  JAVA_PROVIDER="other" ;;
esac
